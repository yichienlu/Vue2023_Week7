import{P as k}from"./PaginationComponent-d57e945e.js";import{_ as g,o as l,c as d,d as o,k as p,v as u,q as M,M as x,r as h,F as b,h as V,e as C,t as c}from"./index-5511e744.js";const A={data(){return{tempCoupon:{},due_date:0}},props:["couponModal","coupon"],watch:{coupon(){this.tempCoupon=this.coupon;var e=new Date(this.tempCoupon.due_date*1e3);this.due_date=`${e.getFullYear()}-${e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1}-${e.getDate()<10?"0"+e.getDate():e.getDate()}`},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},D={class:"modal-dialog",role:"document"},E={class:"modal-content"},U={class:"modal-header"},P={class:"modal-title",id:"exampleModalLabel"},T={key:0},L={key:1},S=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),w={class:"modal-body"},R={class:"mb-3"},B=o("label",{for:"title"},"標題",-1),I={class:"mb-3"},N=o("label",{for:"coupon_code"},"優惠碼",-1),O={class:"mb-3"},F=o("label",{for:"due_date"},"到期日",-1),H={class:"mb-3"},J=o("label",{for:"price"},"折扣百分比",-1),q={class:"mb-3"},W={class:"form-check"},Y=o("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),j={class:"modal-footer"},z=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function G(e,t,_,f,n,i){return l(),d("div",D,[o("div",E,[o("div",U,[o("h5",P,[_.coupon.id?(l(),d("span",T,"編輯優惠券")):(l(),d("span",L,"新增優惠券"))]),S]),o("div",w,[o("div",R,[B,p(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=s=>n.tempCoupon.title=s),placeholder:"請輸入標題"},null,512),[[u,n.tempCoupon.title]])]),o("div",I,[N,p(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=s=>n.tempCoupon.code=s),placeholder:"請輸入優惠碼"},null,512),[[u,n.tempCoupon.code]])]),o("div",O,[F,p(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=s=>n.due_date=s)},null,512),[[u,n.due_date]])]),o("div",H,[J,p(o("input",{type:"number",class:"form-control",id:"price",min:"0",max:"100","onUpdate:modelValue":t[3]||(t[3]=s=>n.tempCoupon.percent=s),placeholder:"請輸入折扣百分比"},null,512),[[u,n.tempCoupon.percent,void 0,{number:!0}]])]),o("div",q,[o("div",W,[p(o("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=s=>n.tempCoupon.is_enabled=s)},null,512),[[M,n.tempCoupon.is_enabled]]),Y])])]),o("div",j,[z,_.coupon.id?(l(),d("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=s=>this.$emit("editCoupon",n.tempCoupon))}," 確認編輯 ")):(l(),d("button",{key:1,type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=s=>this.$emit("addCoupon",n.tempCoupon))}," 確認新增 "))])])])}const K=g(A,[["render",G]]),{VITE_URL:m,VITE_PATH:r}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"yclu",BASE_URL:"/Vue2023_Week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Q={data(){return{tempCoupon:{},coupons:[],couponModal:null,pagination:{}}},components:{CouponModal:K,Pagination:k},methods:{getAdminCoupons(e=1){this.$http.get(`${m}/api/${r}/admin/coupons/?page=${e}`).then(t=>{this.coupons=t.data.coupons,this.pagination=t.data.pagination}).catch(t=>{console.log(t)})},addCoupon(e){this.$http.post(`${m}/api/${r}/admin/coupon`,{data:e}).then(t=>{alert(t.data.message),this.couponModal.hide(),this.getAdminCoupons()}).catch(t=>{console.log(t)})},editCoupon(e){this.$http.put(`${m}/api/${r}/admin/coupon/${this.tempCoupon.id}`,{data:e}).then(t=>{alert(t.data.message),this.couponModal.hide(),this.getAdminCoupons()}).catch(t=>{console.log(t)})},deleteCoupon(e){this.$http.delete(`${m}/api/${r}/admin/coupon/${e}`).then(t=>{alert(t.data.message),this.getAdminCoupons()}).catch(t=>{console.log(t)})}},mounted(){this.getAdminCoupons(),this.couponModal=new x("#couponModal")}},X={class:"container my-5"},Z=o("h1",null,"優惠券管理",-1),oo={class:"text-end mt-3"},to={class:"table mt-4"},eo=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),no={key:0,class:"text-success"},so={key:1,class:"text-muted"},lo={class:"btn-group"},ao=["onClick"],io=["onClick"],po={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"};function uo(e,t,_,f,n,i){const s=h("pagination"),y=h("coupon-modal");return l(),d(b,null,[o("div",X,[Z,o("div",oo,[o("button",{class:"btn btn-primary",type:"button","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:t[0]||(t[0]=a=>this.tempCoupon={is_enabled:0})}," 建立新的優惠券 ")]),o("table",to,[eo,o("tbody",null,[(l(!0),d(b,null,V(n.coupons,(a,v)=>(l(),d("tr",{key:v},[o("td",null,c(a.title)+" "+c(typeof a.title),1),o("td",null,c(a.percent)+"%",1),o("td",null,c(e.$filters.date(a.due_date)),1),o("td",null,[a.is_enabled===1?(l(),d("span",no,"啟用")):(l(),d("span",so,"未啟用"))]),o("td",null,[o("div",lo,[o("button",{type:"button",class:"btn btn-outline-primary btn-sm","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:$=>this.tempCoupon=JSON.parse(JSON.stringify(a))}," 編輯 ",8,ao),o("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:$=>i.deleteCoupon(a.id)}," 刪除 ",8,io)])])]))),128))])]),C(s,{pages:n.pagination,onChangePage:i.getAdminCoupons},null,8,["pages","onChangePage"])]),o("div",po,[C(y,{coupon:n.tempCoupon,"coupon-modal":n.couponModal,onEditCoupon:i.editCoupon,onAddCoupon:i.addCoupon},null,8,["coupon","coupon-modal","onEditCoupon","onAddCoupon"])],512)],64)}const ro=g(Q,[["render",uo]]);export{ro as default};
